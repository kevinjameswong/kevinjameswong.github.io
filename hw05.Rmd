---
title: "hw05: Regex in the Air"
author: 'STAT 385, Spring 2018'
date: 'Due: Friday, March 30th, 2018 at 11:59 PM'
output:
  html_document:
    theme: readable
    toc: yes
---

# Overview 

Please see the [homework policy](http://stat385.thecoatlessprofessor.com/homework-policy/)
for detailed instructions and some grading notes. Failure to follow instructions
will result in point reductions. In particular, make sure to commit each 
exercise as you complete them. 

> "With great **expressivity** comes great responsibility."
>
> --- Uncle Ben

## Objectives 

The objectives behind this homework assignment are as follows:

- Manipulating strings;
- Concatenating strings together;
- Identifying, extracting, and replacing patterns in a string with regular expressions;
- Coercing data types;
- Creating and interpreting graphs

## Grading

The rubric CAs will use to grade this assignment is:

| Task                                                   | pts |
|:-------------------------------------------------------|----:|
| Link to GitHub Repository   	                         | 2   |
| At least one commit per exercise (more is better!)     | 5   |
| Commit messages that describe what changed	           | 5   |
| Pocketful of Sunshine                                  | 10  |
| Root Canal                                             | 12  |
| Eating Paste                                           | 12  |
| File Name Meta Data                                    | 10  |
| Presidental? + EC                                      | 22 + 10 |
| Total                                                  | 78 + 10 |

## Note on Regular Expressions

For this homework assignment, it is _strongly_ recommend that you consult the
[Regular Expression lecture slides](http://stat385.thecoatlessprofessor.com/lectures/15-regular-expressions/15-regular-expressions.pdf). Other resources that may be helpful include: 

- [`stringr` cheatsheet](https://github.com/rstudio/cheatsheets/raw/master/strings.pdf)
- [regexplain RStudio Addin](https://github.com/gadenbuie/regexplain)
- [regex101.com](https://regex101.com/) / [regexr.com](https://regexr.com/)

## Package usage

For this homework assignment, you may only use the following _R_ packages:

```{r}
#install.packages(c("ggplot2", "stringr"))
library(ggplot2)
library(stringr)
```

-----

## (12 Points) Exercise 0: [Get ready to GITHUB!](https://www.youtube.com/watch?v=Vc37XBI6dyE)

**NB** When cloning this repository, you should opt-in to using the
"base" template of the STAT 385 Workspace on RStudio Cloud.

- **[2 Points] (a)** Place a link to your `hw05` GitHub repository here.

- James told the class that it's ok to work with other students on the homework, but you have to put it in your markdown. I worked with Brett Meyer and Alex Shirley.

[Kevin's link to hw05 GitHup repository](https://github.com/stat385-sp2018/hw05-KevinWong2)

- **[5 Points] (b)** Commit every exercise as you finish them. 
- **[5 Points] (c)** Make each commit message _meaningful_. 
    - The bare minimum for a "meaningful" commit is a length of 15 characters.
    - Inside the commit message, please make sure to appropriately describe 
      what is happening.
          - e.g. stating "Exercise 3" or "Ex3" is **not** sufficient.
          - Provide details on the state, e.g. "Finished exercise 3" or
          "Checking in a work in progress attempt on iterating over hockey data."
      
## (10 Points) Exercise 1: [Pocketful of Sunshine](https://www.youtube.com/watch?v=gte3BoXKwP0)

[**2 points each**] Answer the following questions by creating a pattern
that satisfies the test cases listed below. To form the test case vector,
combine the listed cases together and use the appropriate `stringr` function.

- **(a)** Any letter in your first name in lower case. 
    - **Matches:** If your first name is `james`, then match any word with:
      `j`, `a`, `m`, `e`, or `s`. 
    - **Test cases:** `"james"`, `"pete"`, `"lee"`, `"ajay"`, `"ann"`, `"hoodie"`,
      and `"uru"`.

```{r detecting-k-in-test-cases}
test_cases_ex_1a = c("james", "pete", "lee", "ajay", "ann", "hoodie", "uru")
str_detect(string = test_cases_ex_1a, pattern = "k|e|v|i|n")
```

- **(b)** _Only_ lowercase letters.
    - **Matches:** "helloworld" but not "Hello World!" or "hello world"
        - _Hint:_ Anchors and quantifiers are your friend.
    - **Test cases:** `"today is the DAY!"`, `"go illini"`, `"Orange and Blue"`,
                      `"CAPS LOCK"`, `"stat 385"`, `"R2D2"`, `"rstats"`.

```{r detecting-lowercases-in-test-cases}
test_cases_ex_1b = c("today is the DAY!", "go illini", "Orange and Blue", "CAPS LOCK", "stat 385", "R2D2", "rstats")
str_detect(string = test_cases_ex_1b, pattern = "^[a-z]+$")
```

- **(c)** Alphanumeric password between 4 and 9 characters long
    - **Matches:** 4 - 9 characters that contains only a-z, A-Z, or 0-9.
    - **Test Cases:** `"seeing4Miles"`, `"h@llowed1"`, `"pie2Go"`, `"sunsun"`, `"laugh2Jokes"`

```{r detecting-passwords-in-test-cases}
test_cases_ex_1c = c("seeing4Miles", "h@llowed1", "pie2Go", "sunsun", "laugh2Jokes")
str_detect(string = test_cases_ex_1c, pattern = "^[a-zA-Z0-9]{4,9}$")
```

- **(d)** Any numbers between 1 and 999
    - **Matches:** 1, 2, ..., 42, ..., 180, ..., 999. Does _not_ match: 001, 05 ... 
    - **Test Cases:** `"001"`, `"1"`, `"15"`, `"891"`, `"05"`, `"0"`, `"999"`

```{r detecting-numbers-0-to-999-in-test-cases}
test_cases_ex_1d = c("001", "1", "15", "891", "05", "0", "999")
str_detect(string = test_cases_ex_1d, pattern = "^[1-9][0-9]{0,2}$")
```

- **(e)** Sentences or questions that being with a capital letter and end with proper punctuation
    - **Matches:** "How are you today?", "Goodbye Pete." Does _not_ match "good morning." or "Good Morning!"
    - **Test Cases:** `"What's your favorite color?"`, `"I am 10 years old!"`, `"stringr is a package."`, `"Go green to save the planet."`

```{r detecting-sentences-or-questions-in-test-cases}
test_cases_ex_1e = c("What's your favorite color?", "I am 10 years old!", "stringr is a package.", "Go green to save the planet.")
str_detect(string = test_cases_ex_1e, pattern = "^[[:upper:]].*[[:punct:]]$")
```

## (12 Points) Exercise 2: Root Canal

[**4 points each**] Answer the following questions by creating a pattern
that satisfies the test cases listed below. To form the test case vector,
combine the listed cases together and use the appropriate `stringr` function.

- **(a)** Extract hashtag references from embedded text.
    - **Matches:** `#text` and extracts the value `#text`
       - _Hint:_ This requires two steps: Extraction and Replacement.
    - **Test Cases:** `"no tag"`, `"#rstats #rcpp"`, `"hi #stat385"`, `"my #regex is #improving"`

```{r extracting-hashtags-in-test-cases}
test_cases_ex_2a = c("no tag", "#rstats #rcpp", "hi #stat385", "my #regex is #improving")
str_extract_all(string = test_cases_ex_2a, pattern = "#[[:alnum:]]+")
```

- **(b)** Match and Extract the Dimensions of a Monitor
    - **Matches:** Three to four numbers followed by an `x` and then 3 to 4 more numbers.
    - **Test Cases:** `"640x480"`, `"800x600"`, `"960x720"`, `"1024x768"`, `"1920x1200"`, `"2560x1600"`

```{r extracting-dimensions-in-test-cases}
test_cases_ex_2b = c("640x480", "800x600", "960x720", "1024x768", "1920x1200", "2560x1600")
str_extract(string = test_cases_ex_2b, pattern = "^[0-9]{3,4}x[0-9]{3,4}")
```

- **(c)** Isolate file IDs from file extensions
    - **Matches:** `file_xxxxx.pdf`, extracts `file_xxxxx`, and discards file extensions (e.g. `.pdf`, `.png`)
         - _Hint:_ Extract and then replacement to retrieve only `file_xxxx`
    - **Test Cases**: `"file_transcript.pdf"`, `"file_stat385sol.Rmd"`, `"file_grad_shot.png"`, `"991.docx"`, `"grades.xls"`
    - **Note** `991.docx` and `grade.xls` are **not** valid and should be _excluded_ during the extract
      portion.

```{r extracting-file-IDs-in-test-cases}
test_cases_ex_2c = c("file_transcript.pdf", "file_stat385sol.Rmd.", "file_grad_shot.png", "991.docx", "grades.xls")
c2 = str_extract(string = test_cases_ex_2c, pattern = "^file_.*")
str_replace_all(string = c2, pattern = "\\..*", replacement = "")
```

## (12 Points) Exercise 3: Eating Paste

- **[4 Points] (a)** Create a _telegram_ by concatenating
  and manipulating a character vector under the following rules: 
  "`START"` followed by a space, the `message` in UPPER case,
  and a space followed by `"END"`.
    - `"Old Days"` -> `"START OLD DAYS END"`
    - `"my love hailey"` -> `"START MY LOVE HAILEY END"`

```{r telegram-string-creator}
test_cases_ex_3a = c("Old Days", "my love hailey")
final_message = str_to_upper(str_c("START ", test_cases_ex_3a, " END"))
final_message
```

- **[4 Points] (b)** Consider the following URL: <http://www.dmi.illinois.edu/stuenr/class/enrspXX.xls>, 
  where `XX` denotes the last two digits of the year. Create URLs for `2010` 
  through `2018` by pasting together strings.

```{r telegram-string-creator2}
test_cases_ex_3b = c("http://www.dmi.illinois.edu/stuenr/class/enrspXX.xls")
str_replace(string = test_cases_ex_3b, pattern = "XX", replacement = as.character(10:18))
```

- **[4 Points] (c)** Explain the concatenation difference between `paste` and
  `paste0`.

- `paste0()` is `paste` except `paste0()` has NO space in between each part of the string. With `paste`, you can insert whatever you want in between each part of the string using `sep = `.

## (10 Points) Exercise 4: File Name Meta Data

Oh no! The scientist who was working on collecting data related to 
vapor pressure deficiency -- a metric that combinestemperature and relative humidity data
-- across **thousands** of plot locations in Illinois to address the invasive
understory plant [Amur honeysuckle (Lonicera maackii)](https://en.wikipedia.org/wiki/Lonicera_maackii)
had a mishape with how their sensors tracked metadata about the locations.

The scientists setup the sensor to labelled their file name with all of the meta
data about the experiment, however, they forgot include it inside the observations!
They hope to recover the information from the file names and add it alongside
each measurement recorded. Your contact within the lab sent over the following
file names:

- P895-A2-S10_20160821.csv
- P895-A2-S3_20160821.csv
- P893-A1-S6_20160821.csv
- P15-A1-S1.20160929.csv
- P15-A3-S2.20161001.csv
- P15-A4-S3.20161003.csv
- P4-A2-S2.20160815.csv
- P4-A2-S2.20160816.csv
- P4-A2-S2.20160817.csv

Help the scientist out by writing _R_ code that extracts the metadata from the
file name and _stores_ it into a `data.frame`. The `data.frame` should
have the following variables and data types: 

- `plot` (factor)
- `area` (factor)
- `sensor` (factor)
- `year` (integer)
- `month` (integer)
- `day` (integer)

The file name is _thankfully_  organized such that:

- `P`: denotes the plot;
- `A`: denotes the area on the plot a sensor was placed;
- `S`: denotes the sensor; and
- `YYYYMMDD` denotes the Year Month and Day format of the sensor.

**Example Output:**

```
 plot area sensor year month day
 P895   A2    S10 2016     8  21
 P895   A2     S3 2016     8  21
 P893   A1     S6 2016     8  21
  P15   A1     S1 2016     9  29
  P15   A3     S2 2016    10   1
  P15   A4     S3 2016    10   3
   P4   A2     S2 2016     8  15
   P4   A2     S2 2016     8  16
   P4   A2     S2 2016     8  17
```

_Hints_: To transform a `list` into a `data.frame`, use:

```r
list_to_df = function(my_list_data) {
    do.call(rbind.data.frame, my_list_data)
}

my_dataframe = list_to_df(your_list_here)
```

Recall to perform an _explicit_ conversion between data types use `as.*()`.
To move between a `factor` and a, you must first convert to a
`character` and then

_Remark:_ Yes, this does come up in research. Generally, files should be 
labelled this way as it is _machine_ readable. For examples, see Jenny Bryan's 
["Names matter"](http://www2.stat.duke.edu/~rcs46/lectures_2015/01-markdown-git/slides/naming-slides/naming-slides.pdf#page=3)
slides.

```{r file-name-split}
test_cases_ex_4a = c("P895-A2-S10_20160821.csv", "P895-A2-S3_20160821.csv", "P893-A1-S6_20160821.csv", "P15-A1-S1.20160929.csv", "P15-A3-S2.20161001.csv", "P15-A4-S3.20161003.csv", "P4-A2-S2.20160815.csv", "P4-A2-S2.20160816.csv", "P4-A2-S2.20160817.csv")
Plot = as.factor(str_extract(string = test_cases_ex_4a, "P[0-9]+"))
Area = as.factor(str_extract(string = test_cases_ex_4a, "A[0-9]"))
Sensor = as.factor(str_extract(string = test_cases_ex_4a, "S[0-9]{1,2}"))
date_cases_4a = (str_extract(string = test_cases_ex_4a, "[0-9]{8}"))
Year = as.integer(str_sub(string = date_cases_4a, start = 1, end = 4))
Month = as.integer(str_sub(string = date_cases_4a, start = 5, end = 6))
Day = as.integer(str_sub(string = date_cases_4a, start = 7, end = 8))
my_dataframe = cbind.data.frame(Plot, Area, Sensor, Year, Month, Day)
```

## (22 + 10 Points) Exercise 5: Presidental?

Consider the [Factba.se](https://factba.se/) transcripts of Trump from
Jun 1980 - February 2018. All of the transcripts have been available in the
`data.frame` called `trump_records` stored in an _R binary_ file (`.rda`).
Please consider this data to be sensitive and _avoid_ sharing the data with 
anyone outside of STAT 385 @ UIUC during SP 2018. Please retrieve the data from
our password protected course website on [Compass2g](https://compass2g.illinois.edu).

_R binary_ files can be read into _R_ using:

```r
load("path/to/file.rda")
```

Doing so will load any data contained within the `.rda` into the _global_
environment. 

**Recall:** To create a new variable in a pre-existing `data.frame` use: 

```r
my_df$var = vector_of_values
```

- **[4 Points] (a)** Split the `timestamp` into three columns and include them
  in the `data.frame`.
    - `Start Time`: Data type should be a `character`
    - `End Time`: Data type should be a `character`
    - `Duration`: Data type should be an `integer`
        - **Discard** the `"sec"` associated with the duration.

```{r start-end-duration-columns}
load("trump_records.rda")
str_extract_all(trump_records$time, "[[:digit:]]{2}:[[:digit:]]{2}:[[:digit:]]{2}", simplify = TRUE)
trump_records$Start_Time = str_extract_all(string = trump_records$time, pattern =  "[[:digit:]]{2}:[[:digit:]]{2}:[[:digit:]]{2}", simplify = TRUE)[, 1]
trump_records$End_Time = str_extract_all(string = trump_records$time, pattern = "[[:digit:]]{2}:[[:digit:]]{2}:[[:digit:]]{2}", simplify = TRUE)[, 2]
trump_records$Duration = str_extract(string = trump_records$time, pattern = "\\(.*$")
trump_records$Duration = as.integer(substr(trump_records$Duration, 2, nchar(trump_records$Duration) - 5))
```

- **[2 Points] (c)** Remove punctation from the `text` and leave an empty character
  in its place.

```{r remove-punct}
letters_numbers_only = str_replace_all(string = trump_records$text, pattern = "[[:punct:]]", replacement = "")
head(letters_numbers_only)
#using head here because it was a long amount of strings
```

- **[4 Points] (d)** Include counts of both the number of 
  _characters_ and _words_ in `text` for each speech blurb in the `data.frame`
    - _Hint:_ We did this in lecture.
    
```{r word-character-count}
trump_records$characters = str_count(string = trump_records$text, pattern = "[[:alnum:]]")
trump_records$words = str_count(string = trump_records$text, pattern = "\\w+")
```

- **[4 Points] (e)** Create a graph that shows a comparison of the
  number of words used by **Donald Trump** over the _years_.
    - _Hint:_ Subset the data before graphing.

```{r trump-words-years}
trump_records$Year = as.integer(str_extract_all(trump_records$date, "[[:digit:]]{4}", simplify = TRUE)[, 1])
ggplot(data = trump_records, mapping = aes(x = Year)) + 
  geom_histogram(binwidth = 1, fill = "darkblue", color = "orange") + 
    labs(x = "Year", y = "Count")
```

- **[4 Points] (f)** Create a graph that shows the durations of _each speaker_'s
  speech blurb recorded in **2018**.
    - _Hint:_ Subset the data before graphing.

```{r 2018-speaker-graph}
data2018 = trump_records[trump_records$Year == 2018, ]
ggplot(data = data2018, mapping = aes(x = data2018$Duration)) +
  geom_histogram(binwidth = 5, fill = "darkblue", color = "orange") +
    labs(x = "Duraction (seconds)", y = "Count")
```

- **[4 Points] (g)** Write an interpretation in _paragraph form_ for each graph.

- I chose a histogram for 5e because `Year` is an integer. Most of the dataset occurs after the Year 2015.There is a very high peak in the histogram in the Year 2016, during Trump's President Campaign. The earliest recordings of the dataset are from 1980. 
- I chose a histogram for 5f as well because `Duration` is an integer. The histogram is heavily skewed right because most of the data lies between 0-30 seconds. This may indicate that this is a lot of data of Trump giving speeches because he may need to pause after 30 seconds. There are a few outliers of people speaking for a couple minutes. The highest peak of the histogram is the bin that contains 0-2 seconds because in conversation, many people speak for this amount of time.

### (+10 Points) Extra Credit

- **[6 Points] (a)** Split the `speakers` name into three variables `first`, 
  `middle`, and `last` that correspond to how a person's name can be broken down.
    - If a speaker does _not_ have a middle or last name, then fill the entry with `NA`.
    - For speakers with names that contain at least four words, only worry about
      capturing at most three of the words semi-accurately.

```{r first-middle-last-name-split}
name_split = str_split(string = trump_records$speakers, pattern = " ", simplify = TRUE)
trump_records$First_Names = name_split[, 1]
trump_records$Middle_Names = ifelse((name_split[, 3] == ""), NA, name_split[, 2])
trump_records$Last_Names = ifelse((name_split[, 2] == ""), NA, ifelse(name_split[, 3] == "", name_split[, 2], name_split[, 3]))

#trump_records$First_Names[1]
#trump_records$Middle_Names[1]
#trump_records$Last_Names[1]

#trump_records$First_Names[466]
#trump_records$Middle_Names[466]
#trump_records$Last_Names[466]

#trump_records$First_Names[1341]
#trump_records$Middle_Names[1341]
#trump_records$Last_Names[1341]
```

- **[4 Points] (b)** Create a graph that provides a count of the number of times
    each first name comes up in the data. 

```{r first-name-bar-plot}
ggplot(data = trump_records, mapping = aes(x = First_Names)) + 
  geom_bar() + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
#There are so many first names in the data set, and it is hard to make the bar plot look good.
```

